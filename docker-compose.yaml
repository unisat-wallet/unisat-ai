version: '3.8'

services:
  # Chat App Frontend
  chat-frontend:
    build:
      context: .
      dockerfile: packages/chat-app/frontend/Dockerfile
      args:
        # Update these URLs to match your deployment domain
        NEXT_PUBLIC_WS_URL: ${NEXT_PUBLIC_WS_URL:-ws://localhost:3002}
        NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL:-http://localhost:3001}
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
    depends_on:
      - chat-backend
    restart: unless-stopped
    networks:
      - unisat-network

  # Chat App Backend
  chat-backend:
    build:
      context: .
      dockerfile: packages/chat-app/backend/Dockerfile
    ports:
      - "3001:3001"  # HTTP API
      - "3002:3002"  # WebSocket
    environment:
      - NODE_ENV=production
      - PORT=3001
      - WS_PORT=3002
      # UniSat API (required)
      - UNISAT_API_KEY=${UNISAT_API_KEY}
      # AI Provider: anthropic | openai | agentkit
      - AI_PROVIDER=${AI_PROVIDER:-anthropic}
      # Anthropic (if using Claude)
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - ANTHROPIC_MODEL=${ANTHROPIC_MODEL:-claude-3-5-sonnet-20241022}
      # OpenAI (if using OpenAI/compatible API)
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - OPENAI_BASE_URL=${OPENAI_BASE_URL:-}
      - OPENAI_MODEL=${OPENAI_MODEL:-gpt-4o}
      # AgentKit (if using BytePlus AgentKit)
      - AGENTKIT_BASE_URL=${AGENTKIT_BASE_URL:-}
      - AGENTKIT_API_KEY=${AGENTKIT_API_KEY:-}
      # Doc Search
      - DOC_SEARCH_DB_PATH=${DOC_SEARCH_DB_PATH:-/app/packages/doc-search/data/docs.lance}
      - DOC_SEARCH_DATA_PATH=${DOC_SEARCH_DATA_PATH:-/app/packages/doc-search/data}
      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER:-tfidf}
      # Documentation source (auto-fetch from GitHub on startup)
      - DOCS_REPO_URL=${DOCS_REPO_URL:-https://github.com/unisat-wallet/unisat-dev-docs}
      - DOCS_BRANCH=${DOCS_BRANCH:-main}
    restart: unless-stopped
    networks:
      - unisat-network

networks:
  unisat-network:
    driver: bridge
